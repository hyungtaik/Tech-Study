# Spring Security

### ğŸ“ ë³´ì•ˆ ìš©ì–´

> **ì ‘ê·¼ ì£¼ì²´(Principal)** : ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ëŒ€ìƒ
>
> **ì¸ì¦(Authentication)** : ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•œ ëŒ€ìƒì— ëŒ€í•´ ì´ ìœ ì €ê°€ ëˆ„êµ¬ì¸ì§€, ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•´ë„ ë˜ëŠ” ì£¼ì²´ì¸ì§€ í™•ì¸í•˜ëŠ” ê³¼ì • (ex. Loginí•œ ì‚¬ìš©ìë“¤ì—ê²Œë§Œ ê¸°ëŠ¥ ì‚¬ìš© ë“±)
>
> > **[ì¢…ë¥˜]**
> >
> > **1) ìê²©(Credential) ê¸°ë°˜ ì¸ì¦**
> >
> > - ê¶Œí•œì„ ë¶€ì—¬ë°›ëŠ”ë° í•œ ì°¨ë¡€ì˜ ì¸ì¦ê³¼ì •ì´ í•„ìš”í•˜ë©° ëŒ€ë¶€ë¶„ ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥ë°›ì•„ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ê°€ ì €ì¥ëœ ë¹„ë°€ë²ˆí˜¸ì™€ ì¼ì¹˜í•˜ëŠ”ê²ƒì„ í™•ì¸í•œë‹¤. 
> > - ì¼ë°˜ì ìœ¼ë¡œ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì—ì„œëŠ” **ì•„ì´ë””ë¥¼ principle, ë¹„ë°€ë²ˆí˜¸ë¥¼ credential**. 
> >
> > **2) ì´ì¤‘ ì¸ì¦(Two-factor Authentication**
> >
> > - í•œë²ˆì— 2ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ì¸ì¦ì„ ë°›ëŠ” ê²ƒì„ ë§í•œë‹¤.
> >   - ê¸ˆìœµ, ì€í–‰ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì´ìš©í•´ ê±°ë˜ë¥¼ í•  ê²½ìš°, ë¡œê·¸ì¸ê³¼ ë³´ì•ˆ ì¸ì¦ì„œë¥¼ í†µí•œ 2ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ì¸ì¦ì„ ë°›ëŠ”ë‹¤.
> >
> > **3) ë¬¼ë¦¬ì ì¸ ì¸ì¦**
> >
> > - ì§€ë¬¸ì„ ì¸ì‹ë°›ê±°ë‚˜ í‚¤ë¥¼ ì‚½ì…í•˜ì—¬ ì¸ì¦í•˜ëŠ” ê²ƒì„ ë§í•œë‹¤.
>
> **ê¶Œí•œ ë¶€ì—¬(Authorization) **
>
> > - ì¸ê°€(Authorize) : í•´ë‹¹ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•´ ì ‘ê·¼ ê°€ëŠ¥í•œ ê¶Œí•œì„ ê°€ì§€ê³  ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ê³¼ì •(After Authentication, ì¸ì¦ ì´í›„)
> > - ê¶Œí•œ : ì–´ë– í•œ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì ‘ê·¼ ì œí•œ, ëª¨ë“  ë¦¬ì†ŒìŠ¤ëŠ” ì ‘ê·¼ ì œì–´ ê¶Œí•œì´ ê±¸ë ¤ìˆë‹¤. ì¦‰, ì¸ê°€ ê³¼ì •ì—ì„œ í•´ë‹¹ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì œí•œëœ ìµœì†Œí•œì˜ ê¶Œí•œì„ ê°€ì¡ŒëŠ”ì§€ í™•ì¸í•œë‹¤.
>
> > **[ì¢…ë¥˜] **
> >
> > **1) ë¶€ì—¬ëœ ê¶Œí•œ(Granted Autority)**
> >
> > - **ì ì ˆí•œ ì ˆì°¨ë¡œ ì‚¬ìš©ìê°€ ì¸ì¦ë˜ì—ˆë‹¤ë©´ ê¶Œí•œì„ ë¶€ì—¬**í•´ì•¼ í•œë‹¤.
> >   - íšŒì›ê°€ì… ë“±ìœ¼ë¡œ ë°˜ì˜êµ¬ì ì¸ ê¶Œí•œì´ ë¶€ì—¬ë˜ì—ˆë‹¤ë©´ ì´ ì‚¬ìš©ìì˜ ê¶Œí•œì„ ì–´ë”˜ê°€ì— ì €ì¥í•´ì•¼ í•˜ê³ , í•´ë‹¹ ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ í–ˆì„ ë•Œ ë©”ì¸ í˜ì´ì§€ë¡œ ë„˜ì–´ê°ˆ ìˆ˜ ì—†ë‹¤ë©´ ê¶Œí•œ ë¶€ì—¬ì— ë¬¸ì œê°€ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.
> >
> > **2) ë¦¬ì†ŒìŠ¤ì˜ ê¶Œí•œ(Intercept) **
> >
> > - ì‚¬ìš©ìì˜ ê¶Œí•œë§Œ ìˆë‹¤ê³  ë³´ì•ˆì´ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤. ë³´ì•ˆì´ë€ ê¶Œí•œì´ ì—†ëŠ” ìë“¤ì´ ì›ì²œì ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ì—†ë„ë¡ ë§‰ì•„ë‚´ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì´ë‹¤. ê·¸ëŸ° ì˜ë¯¸ì—ì„œ **ì ì ˆí•œ ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ìì—ê²Œë§Œ í•´ë‹¹ ìì›ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ìì›ì˜ ì™¸ë¶€ ìš”ì²­ì„ ì›ì²œì ìœ¼ë¡œ ê°€ë¡œì±„ëŠ” ê²ƒ(Intercept)ì´ ì›¹ ë³´ì•ˆ**, ê·¸ ì¤‘ ê¶Œí•œ ë¶€ì—¬ì˜ í•µì‹¬ ì›ì¹™ì´ë¼ í•  ìˆ˜ ìˆë‹¤.

****



### 1. Spring Security ë€?

> - ìŠ¤í”„ë§ ê¸°ë°˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆ(ì¸ì¦ê³¼ ê¶Œí•œ, ì¸ê°€ ë“±)ì„ ë‹´ë‹¹í•˜ëŠ” ìŠ¤í”„ë§ í•˜ìœ„ í”„ë ˆì„ì›Œí¬ì´ë‹¤.
> - ì£¼ë¡œ ì„œë¸”ë¦¿ í•„í„°ì™€ ì´ë“¤ë¡œ êµ¬ì„±ëœ í•„í„°ì²´ì¸ìœ¼ë¡œì˜ ìœ„ì„ëª¨ë¸ì„ ì‚¬ìš©í•œë‹¤.
> - ë³´ì•ˆê³¼ ê´€ë ¨í•´ì„œ ì²´ê³„ì ìœ¼ë¡œ ë§ì€ ì˜µì…˜ì„ ì œê³µí•´ì£¼ê¸° ë•Œë¬¸ì— ê°œë°œì ì…ì¥ì—ì„œëŠ” ì¼ì¼ì´ ë³´ì•ˆ ê´€ë ¨ ë¡œì§ì„ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.
> - ì¸ì¦ê³¼ ê¶Œí•œ ì œì–´ì— í•„ìš”í•œ í•„í„°ì˜ ëª¨ìŒì´ë‹¤. í•„í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê¶Œí•œì— ë”°ë¥¸ ì ‘ê·¼ ì œì–´ ê¸°ëŠ¥, íŒ¨ìŠ¤ì›Œë“œ ì•”í˜¸í™” ë“± ì „ë°˜ì ì¸ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê³  ìˆì–´ì„œ ì‹¤ë¬´ì—ì„œ ë§ì´ ì‚¬ìš©í•œë‹¤.
>
> #### 1) ì¸ì¦ê´€ë ¨ êµ¬ì¡°
>
> ![image-20200719182240931](C:\Users\multicampus\AppData\Roaming\Typora\typora-user-images\image-20200719182240931.png)
>
> > **[Form ê¸°ë°˜ ë¡œê·¸ì¸ì— ëŒ€í•œ Flow]**
> >
> > 1. ì‚¬ìš©ìê°€ Formì„ í†µí•´ ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ì¸ì¦ ìš”ì²­ì„ ë³´ë‚¸ë‹¤.
> > 2. AuthenticationFilterê°€ HttpServletRequestì—ì„œ ì‚¬ìš©ìê°€ ë³´ë‚¸ ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¸í„°ì…‰íŠ¸í•œë‹¤. Front ë‹¨ì—ì„œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í•  ìˆ˜ë„ ìˆì§€ë§Œ, ì•ˆì „ì„ ìœ„í•´ì„œ ë‹¤ì‹œ í•œë²ˆ ì‚¬ìš©ìê°€ ë³´ë‚¸ ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ì˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í•´ì¤„ ìˆ˜ ìˆë‹¤. (ì•„ì´ë””ë‚˜ ë¹„ë°€ë²ˆí˜¸ê°€ Nullì¼ ê²½ìš°) HttpServletRequestì—ì„œ êº¼ë‚´ì˜¨ ì‚¬ìš©ìì˜ ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‹¤ì§ˆì ì¸ ì¸ì¦ì„ ë‹´ë‹¹í•  AuthenticationManager ì¸í„°í˜ì´ìŠ¤ì—ê²Œ ì¸ì¦ìš© ê°ì²´(UsernamePaawordAuthentication Token)ë¡œ ë§Œë“¤ì–´ì¤˜ì„œ ìœ„ì„í•œë‹¤.
> > 3. AuthenticationFilterì—ê²Œ ì¸ì¦ìš© ê°ì²´(Token)ì„ ì „ë‹¬ë°›ëŠ”ë‹¤.
> > 4. ì‹¤ì œ ì¸ì¦í•  AuthenticationProviderì—ê²Œ Authenticationê°ì²´(Token)ì„ ë‹¤ì‹œ ì „ë‹¬í•œë‹¤.
> > 5. DBì—ì„œ ì‚¬ìš©ì ì¸ì¦ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ UserDetailsService ê°ì²´ì—ê²Œ ì‚¬ìš©ìì˜ ì•„ì´ë””ë¥¼ ë„˜ê²¨ì£¼ê³  DBì—ì„œ ì¸ì¦ì— ì‚¬ìš©í•  ì‚¬ìš©ì ì •ë³´ë¥¼ DuserDetailsë¼ëŠ” ê°ì²´ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤.
> > 6. AuthenticationProviderëŠ” UserDetails ê°ì²´ë¥¼ ì „ë‹¬ë°›ì€ ì´í›„ ì‹¤ì œ ì‚¬ìš©ìì˜ ì…ë ¥ì •ë³´ì™€ UserDetails ê°ì²´ë¥¼ ê°€ì§€ê³  ì¸ì¦ì„ ì‹œë„í•œë‹¤.
> > 7. 8. 9. 10. ì¸ì¦ì´ ì™„ë£Œë˜ë©´ ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì§„ Authentication ê°ì²´ë¥¼ SecurityContextHolderì— ë‹´ì€ ì´í›„ AuthenticationSuccessHandleë¥¼ ì‹¤í–‰í•œë‹¤.  ì‹¤íŒ¨ ì‹œ AuthenticationFailuerHandlerë¥¼ ì‹¤í–‰í•œë‹¤.
>
> #### 2) Securityì˜ Filter
>
> ![image-20200719183646426](C:\Users\multicampus\AppData\Roaming\Typora\typora-user-images\image-20200719183646426.png)
>
> > - SecurityContextPersistenceFilter : SecurityContextRepositoryì—ì„œ SecurityContextë¥¼ ê°€ì ¸ì˜¤ê±°ë‚˜ ì €ì¥í•˜ëŠ” ì—­í• ì„ í•œë‹¤.
> >
> > - LogoutFilter : ì„¤ì •ëœ ë¡œê·¸ì•„ì›ƒ URLë¡œ ì˜¤ëŠ” ìš”ì²­ì„ ê°ì‹œí•˜ë©°, í•´ë‹¹ ìœ ì €ë¥¼ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
> > - (UsernamePassword)AuthenticationFilter : (ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•˜ëŠ” form ê¸°ë°˜ ì¸ì¦) ì„¤ì •ëœ ë¡œê·¸ì¸ URLë¡œ ì˜¤ëŠ” ìš”ì²­ì„ ê°ì‹œí•˜ë©°, ìœ ì € ì¸ì¦ ì²˜ë¦¬
> >   - AuthenticationManagerë¥¼ í†µí•œ ì¸ì¦ ì‹¤í–‰
> >   - ì¸ì¦ ì„±ê³µ ì‹œ, ì–»ì€ Authentication ê°ì²´ë¥¼ SecurityContextì— ì €ì¥ í›„ AuthenticationSuccessHandler ì‹¤í–‰
> >   - ì¸ì¦ ì‹¤íŒ¨ ì‹œ, AuthenticationFailureHandler ì‹¤í–‰
> >
> > - DefaultLoginPageGeneratingFilter : ì¸ì¦ì„ ìœ„í•œ ë¡œê·¸ì¸í¼ URLì„ ê°ì‹œí•œë‹¤.
> > - BasicAuthenticationFilter : HTTP ê¸°ë³¸ ì¸ì¦ í—¤ë”ë¥¼ ê°ì‹œí•˜ì—¬ ì²˜ë¦¬í•œë‹¤.
> > - RequestCacheAwareFilter : ë¡œê·¸ì¸ ì„±ê³µ í›„, ì›ë˜ ìš”ì²­ ì •ë³´ë¥¼ ì¬êµ¬ì„±í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤.
> > - SecurityContextHolderAwareRequestFilter : HttpServletRequestWrapperë¥¼ ìƒì†í•œ SecurityContextHolderAwareRequestWapper í´ë˜ìŠ¤ë¡œ HttpServletRequest ì •ë³´ë¥¼ ê°ì‹¼ë‹¤. SecurityContextHolderAwareRequestWrapper í´ë˜ìŠ¤ëŠ” í•„í„° ì²´ì¸ìƒì˜ ë‹¤ìŒ í•„í„°ë“¤ì—ê²Œ ë¶€ê°€ì •ë³´ë¥¼ ì œê³µí•œë‹¤.
> > - AnonymousAuthenticationFilter : ì´ í•„í„°ê°€ í˜¸ì¶œë˜ëŠ” ì‹œì ê¹Œì§€ ì‚¬ìš©ì ì •ë³´ê°€ ì¸ì¦ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì¸ì¦í† í°ì— ì‚¬ìš©ìê°€ ìµëª… ì‚¬ìš©ìë¡œ ë‚˜íƒ€ë‚œë‹¤.
> > - SessionManagementFilter : ì´ í•„í„°ëŠ” ì¸ì¦ëœ ì‚¬ìš©ìì™€ ê´€ë ¨ëœ ëª¨ë“  ì„¸ì…˜ì„ ì¶”ì í•œë‹¤.
> > - ExceptionTranslationFilter : ì´ í•„í„°ëŠ” ë³´í˜¸ëœ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì¤‘ì— ë°œìƒí•  ìˆ˜ ìˆëŠ” ì˜ˆì™¸ë¥¼ ìœ„ì„í•˜ê±°ë‚˜ ì „ë‹¬í•˜ëŠ” ì—­í• ì„ í•œë‹¤.
> > - FilterSecurityInterceptor : ì´ í•„í„°ëŠ” AccessDecisionManager ë¡œ ê¶Œí•œë¶€ì—¬ ì²˜ë¦¬ë¥¼ ìœ„ì„í•¨ìœ¼ë¡œì¨ ì ‘ê·¼ ì œì–´ ê²°ì •ì„ ì‰½ê²Œí•´ì¤€ë‹¤.
>
> #### 3) Authentication
>
> - ì ‘ê·¼ ì£¼ì²´ëŠ” Authtentication ê°ì²´ë¥¼ ìƒì„±í•œë‹¤. 
> - ì´ ê°ì²´ëŠ” SecurityContext(ë‚´ë¶€ ë©”ëª¨ë¦¬)ì— ë³´ê´€ë˜ê³  ì‚¬ìš©ë˜ì–´ì§„ë‹¤.
>
> ```java
> public interface Authentication extends Principal, Serializable { 
>     Collection<? extends GrantedAuthority> getAuthorities(); // Authentication ì €ì¥ì†Œì— ì˜í•´ ì¸ì¦ëœ ì‚¬ìš©ìì˜ ê¶Œí•œ ëª©ë¡ 
>     Object getCredentials(); // ì£¼ë¡œ ë¹„ë°€ë²ˆí˜¸ 
>     Object getDetails(); // ì‚¬ìš©ì ìƒì„¸ì •ë³´ 
>     Object getPrincipal(); // ì£¼ë¡œ ID 
>     boolean isAuthenticated(); //ì¸ì¦ ì—¬ë¶€ 
>     void setAuthenticated(boolean isAuthenticated) throws IllegalArgumentException; 
> }
> ```
>
> #### 4) Authentication Manager
>
> > - ì‚¬ìš©ìì˜ ìš”ì²­ì„ AuthenticationFilterì—ì„œ Authentication ê°ì²´ë¡œ ë³€í™˜í•´ AuthenticationManager(Provider Manager)ì—ê²Œ ë„˜ê²¨ì£¼ê³ , AuthenticationProviderê°€ ì‹¤ì œ ì¸ì¦ì„ í•œ ì´í›„ì— ì¸ì¦ì´ ì™„ë£Œë˜ë©´ Authentication ê°ì²´ë¥¼ ë°˜í™˜í•´ì¤€ë‹¤.
> >   - AbstractAuthenticationProcessingFilter: ì›¬ ê¸°ë°˜ ì¸ì¦ìš”ì²­ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì»´í¬ë„ŒíŠ¸ë¡œ Post í¼ ë°ì´í„°ë¥¼ í¬í•¨í•˜ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•œë‹¤. ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ë¥¸ í•„í„°ë¡œ ì „ë‹¬í•˜ê¸° ìœ„í•´ì„œ **Authentication ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì¼ë¶€ í”„ë¡œí¼ë¦¬ë¥¼ ì„¤ì •**í•œë‹¤.
> >   - AuthenticationManager: ì¸ì¦ ìš”ì²­ì„ ë°›ê³  Authenticationì„ ì±„ì›Œì¤€ë‹¤.
> >   - AuthenticationProvider: ì‹¤ì œ ì¸ì¦ì´ ì¼ì–´ë‚˜ê³  ë§Œì•½ ì¸ì¦ ì„±ê³µ ì‹œ Authentication ê°ì²´ì˜ authenticated = trueë¡œ ì„¤ì •í•´ì¤€ë‹¤.
> > - Spring SecurityëŠ” ProvideManagerë¼ëŠ” AuthenticationManager ì¸í„°í˜ì´ìŠ¤ì˜ ìœ ì¼í•œ êµ¬í˜„ì²´ë¥¼ ì œê³µí•œë‹¤.
> > - ProvideManagerëŠ” í•˜ë‚˜ ë˜ëŠ” ì—¬ëŸ¬ ê°œì˜ AuthenticationProvider êµ¬í˜„ì²´ë¥¼ ì‚¬ìš©í•  ìˆ˜ìˆë‹¤.
>
> #### 5) ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ê³¼ì •
>
> > - DaoAuthenticationProvider ëŠ” UserDetailsService íƒ€ì… ì˜¤ë¸Œì íŠ¸ë¡œ ìœ„ì„í•œë‹¤. UserDetailsService ëŠ” UserDetails êµ¬í˜„ì²´ë¥¼ ë¦¬í„´í•˜ëŠ” ì—­í• ì„ í•œë‹¤. UserDetails ì¸í„°í˜ì´ìŠ¤ëŠ” ì´ì „ì— ì„¤ëª…í•œ Authentication ì¸í„°í˜ì´ìŠ¤ì™€ ìƒë‹¹íˆ ìœ ì‚¬í•˜ì§€ë§Œ ì„œë¡œ ë‹¤ë¥¸ ëª©ì ì„ ê°€ì§„ ì¸í„°í˜ì´ìŠ¤ì´ë¯€ë¡œ í—·ê°ˆë¦¬ë©´ ì•ˆëœë‹¤. 
> >   - Authentication : ì‚¬ìš©ì ID, íŒ¨ìŠ¤ì›Œë“œì™€ ì¸ì¦ ìš”ì²­ ì»¨í…ìŠ¤íŠ¸ì— ëŒ€í•œ ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆë‹¤. ì¸ì¦ ì´í›„ì˜ ì‚¬ìš©ì ìƒì„¸ì •ë³´ì™€ ê°™ì€ UserDetails íƒ€ì… ì˜¤ë¸Œì íŠ¸ë¥¼ í¬í•¨í•  ìˆ˜ë„ ìˆë‹¤. 
> >   - UserDetails : ì´ë¦„, ì´ë©”ì¼, ì „í™”ë²ˆí˜¸ì™€ ê°™ì€ ì‚¬ìš©ì í”„ë¡œí•„ ì •ë³´ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ ìš©ë„ë¡œ ì‚¬ìš©í•œë‹¤.
>
> #### 6) ì¸ì¦ ì˜ˆì™¸
>
> > ì¸ì¦ê³¼ ê´€ë ¨ëœ ëª¨ë“  ì˜ˆì™¸ëŠ” AuthenticationExceptionì„ ìƒì†í•œë‹¤. AuthenticationExceptionì€ ê°œë°œìì—ê²Œ ìƒì„¸í•œ ë””ë²„ê¹… ì •ë³´ë¥¼ ì œê³µí•˜ê¸° ìœ„í•œ ë‘ê°œì˜ ë©¤ë²„ í•„ë“œë¥¼ ê°€ì§€ê³  ìˆë‹¤. 
> >
> > - authentication : ì¸ì¦ ìš”ì²­ê´€ë ¨ Authentication ê°ì²´ë¥¼ ì €ì¥í•˜ê³  ìˆë‹¤.
> > - extraInformation : ì¸ì¦ ì˜ˆì™¸ ê´€ë ¨ ë¶€ê°€ ì •ë³´ë¥¼ ì €ì¥í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ UsernameNotFoundException ì˜ˆì™¸ëŠ” ì¸ì¦ì— ì‹¤íŒ¨í•œ ìœ ì €ì˜ id ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ìˆë‹¤.
> >
> > ##### * ë§ì´ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ë“¤
> >
> > - BadCredentialsException : ì‚¬ìš©ì ì•„ì´ë””ê°€ ì „ë‹¬ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ì¸ì¦ ì €ì¥ì†Œì˜ ì‚¬ìš©ì id ì— í•´ë‹¹í•˜ëŠ” íŒ¨ìŠ¤ì›Œë“œê°€ ì¼ì¹˜í•˜ì§€ ì•Šì„ ê²½ìš° ë°œìƒí•œë‹¤.
> > - LockedException : ì‚¬ìš©ì ê³„ì •ì´ ì ê¸´ê²½ìš° ë°œìƒí•œë‹¤.
> > - UsernameNotFoundException : ì¸ì¦ ì €ì¥ì†Œì—ì„œ ì‚¬ìš©ì IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ì‚¬ìš©ì IDì— ë¶€ì—¬ëœ ê¶Œí•œì´ ì—†ì„ ê²½ìš° ë°œìƒí•œë‹¤.

<hr>



### 2. ì ‘ê·¼ ê¶Œí•œ ë¶€ì—¬

> - ìë™ìœ¼ë¡œ ì„¤ì •ëœ Spring Security  í•„í„° ì²´ì¸ì˜ ë§ˆì§€ë§‰ ì„œë¸”ë¦¿ í•„í„°ëŠ” FilterSecurityInterceptorì´ë‹¤. ì´ í•„í„°ëŠ” í•´ë‹¹ ìš”ì²­ì˜ ìˆ˜ë½ ì—¬ë¶€ë¥¼ ê²°ì •í•œë‹¤. FilterSecurityInterceptorê°€ ì‹¤í–‰ë˜ëŠ” ì‹œì ì—ëŠ” ì´ë¯¸ ì‚¬ìš©ìê°€ ì¸ì¦ë˜ì–´ ìˆì„ ê²ƒì´ë¯€ë¡œ ìœ íš¨í•œ ì‚¬ìš©ìì¸ì§€ë„ ì•Œ ìˆ˜ ìˆë‹¤.
> - Authentication ì¸í„°í˜ì´ìŠ¤ì— List<GrantedAuthority> getAuthorities() ë¼ëŠ” ë©”ì†Œë“œëŠ” ì‚¬ìš©ì ì•„ì´ë””ì— ëŒ€í•œ ê¶Œí•œ ëª©ë¡ì„ ë¦¬í„´í•œë‹¤. ê¶Œí•œ ì²˜ë¦¬ ì‹œì— ì´ ë©”ì†Œë“œê°€ ì œê³µí•˜ëŠ” ê¶Œí•œ ì •ë³´ë¥¼ ì°¸ì¡°í•´ì„œ í•´ë‹¹ ìš”ì²­ì˜ ìŠ¹ì¸ ì—¬ë¶€ë¥¼ ê²°ì •í•˜ê²Œ ëœë‹¤.
> - Access Decision Manager ë¼ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ì¸ì¦ í™•ì¸ì„ ì²˜ë¦¬í•œë‹¤. AccessDecisionManager ì¸í„°í˜ì´ìŠ¤ëŠ” ì¸ì¦ í™•ì¸ì„ ìœ„í•´ ë‘ê°€ì§€ ë©”ì†Œë“œë¥¼ ì œê³µí•œë‹¤.
>   - supports : AccessDecisionManager êµ¬í˜„ì²´ëŠ” í˜„ì¬ ìš”ì²­ì„ ì§€ì›í•˜ëŠ”ì§€ì˜ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ëŠ” ë‘ê°œì˜ ë©”ì†Œë“œë¥¼ ì œê³µí•œë‹¤. í•˜ë‚˜ëŠ” java.lang.Class íƒ€ì…ì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ê³  ë‹¤ë¥¸ í•˜ë‚˜ëŠ” ConfigAttribute íƒ€ì…ì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ëŠ”ë‹¤.
>   - decide : ì´ ë©”ì†Œë“œëŠ” ìš”ì²­ ì»¨í…ìŠ¤íŠ¸ì™€ ë³´ì•ˆ ì„¤ì •ì„ ì°¸ì¡°í•˜ì—¬ ì ‘ê·¼ ìŠ¹ì¸ì—¬ë¶€ë¥¼ ê²°ì •í•œë‹¤. ì´ ë©”ì†Œë“œì—ëŠ” ë¦¬í„´ê°’ì´ ì—†ì§€ë§Œ ì ‘ê·¼ ê±°ë¶€ë¥¼ ì˜ë¯¸í•˜ëŠ” ì˜ˆì™¸ë¥¼ ë˜ì ¸ ìš”ì²­ì´ ê±°ë¶€ë˜ì—ˆìŒì„ ì•Œë ¤ì¤€ë‹¤.

> - ì¸ì¦ê³¼ì •ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì˜ˆìƒ ê°€ëŠ¥í•œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ëŠ” AuthenticationException ê³¼ í•˜ìœ„ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í–ˆë˜ ê²ƒì²˜ëŸ¼ íŠ¹ì • íƒ€ì…ì˜ ì˜ˆì™¸ í´ë˜ìŠ¤ë“¤ì„ ì‚¬ìš©í•˜ë©´ ê¶Œí•œì²˜ë¦¬ë¥¼ í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë™ì‘ì„ ì¢€ ë” ì„¸ë°€í•˜ê²Œ ì œì–´í•  ìˆ˜ ìˆë‹¤. 
> - AccessDecisionManager ëŠ” í‘œì¤€ ìŠ¤í”„ë§ ë¹ˆ ë°”ì¸ë”©ê³¼ ë ˆí¼ëŸ°ìŠ¤ë¡œ ì™„ë²½íˆ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.ë””í´íŠ¸ AccessDecisionManager êµ¬í˜„ì²´ëŠ” AccessDecisionVoter ì™€ Vote ì·¨í•©ê¸°ë°˜ ì ‘ê·¼ ìŠ¹ì¸ ë°©ì‹ì„ ì œê³µí•œë‹¤.
> - Voter ëŠ” ê¶Œí•œì²˜ë¦¬ ê³¼ì •ì—ì„œ ë‹¤ìŒ ì¤‘ í•˜ë‚˜ ë˜ëŠ” ì „ì²´ë¥¼ í‰ê°€í•œë‹¤.
>   - ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ìš”ì²­ ì»¨í…ìŠ¤íŠ¸ (URL ì„ ì ‘ê·¼í•˜ëŠ” IP ì£¼ì†Œ)
>   - ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸
>   - ì ‘ê·¼í•˜ë ¤ëŠ” ë¦¬ì†ŒìŠ¤
>   - ì‹œìŠ¤í…œì— ì„¤ì •ëœ íŒŒë¼ë¯¸í„°ì™€ ë¦¬ì†ŒìŠ¤

> - AccessDecisionManager ëŠ” ìš”ì²­ëœ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ access attribute ì„¤ì •ì„ voterì—ê²Œ ì „ë‹¬í•˜ëŠ” ì—­í• ë„ í•˜ë¯€ë¡œ voterëŠ” ì›¹ URL ê´€ë ¨ access attribute ì„¤ì • ì •ë³´ë¥¼ ê°€ì§€ê²Œ ëœë‹¤. 
> - VoterëŠ” ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì •ë³´ë¥¼ ì‚¬ìš©í•´ì„œ ì‚¬ìš©ìì˜ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì ‘ê·¼ í—ˆê°€ ì—¬ë¶€ë¥¼ íŒë‹¨í•œë‹¤. ë³´í„°ëŠ” ì ‘ê·¼ í—ˆê°€ ì—¬ë¶€ì— ëŒ€í•´ì„œ ì„¸ ê°€ì§€ ì¤‘ í•œ ê°€ì§€ë¡œ ê²°ì •í•˜ëŠ”ë°, ê° ê²°ì •ì€ AccessDecisionVoter ì¸í„°í˜ì´ìŠ¤ì— ë‹¤ìŒê³¼ ê°™ì´ ìƒìˆ˜ë¡œ ì •ì˜ë˜ì–´ ìˆë‹¤.
>   - **Grant(ACCESS_GRANTED)** : Voter ê°€ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì„ í—ˆê°€í•˜ë„ë¡ ê¶Œì¥í•œë‹¤.
>   - **Deny(ACCESS_DENIED)** : Voter ê°€ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì„ ê±°ë¶€í•˜ë„ë¡ ê¶Œì¥í•œë‹¤.
>   - **Abstain(ACCESS_ABSTAIN)** : Voter ëŠ” ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì ‘ê·¼ê¶Œí•œ ê²°ì •ì„ ë³´ë¥˜í•œë‹¤. ì´ ê²°ì • ë³´ë¥˜ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê²½ìš°ì— ë°œìƒí•  ìˆ˜ ìˆë‹¤.
>     - voter ê°€ ì ‘ê·¼ê¶Œí•œ íŒë‹¨ì— í•„ìš”í•œ ê²°ì •ì ì¸ ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆì§€ ì•Šì€ ê²½ìš°
>     - Voter ê°€ í•´ë‹¹ íƒ€ì…ì˜ ìš”ì²­ì— ëŒ€í•´ ê²°ì •ì„ ë‚´ë¦´ ìˆ˜ ì—†ëŠ” ê²½ìš°

<hr>



### 3. Access

> - hasRole(Role) : í•´ë‹¹ Role ì„ ê°–ê³ ìˆëŠ” ì‚¬ìš©ì í—ˆìš©
> - hasAnyRole(Role1, Role2, ...) : í•´ë‹¹ Role ì¤‘ì— 1ê°œì´ìƒ ê°–ê³ ìˆëŠ” ì‚¬ìš©ì í—ˆìš©
> - anonymous : ìµëª… ì‚¬ìš©ì í—ˆìš©
> - authenticated : ì¸ì¦ëœ ì‚¬ìš©ì í—ˆìš©
> - permitAll : ëª¨ë“  ì‚¬ìš©ì í—ˆìš©
> - denyAll : ëª¨ë“  ì‚¬ìš©ì ì°¨ë‹¨

<hr>



### 4. Spring Security ê´€ë ¨ Annotation

> - @Secured : ê° ìš”ì²­ê²½ë¡œì— ë”°ë¥¸ ê¶Œí•œ ì„¤ì •ì€ ìœ„ì˜ xmlì—ì„œë„ í•  ìˆ˜ ìˆì§€ë§Œ, ë©”ì†Œë“œë ˆë²¨ì—ì„œ @Secured ë¥¼ í†µí•´ì„œë„ í•  ìˆ˜ ìˆë‹¤.  EnableGlobalMethodSecurity(securedEnabled=true) ë¥¼ ì¶”ê°€í•˜ë©´ ëœë‹¤.
>   - @Secured("ROLE_ADMIN") , @Secured({"ROLE_ADMIN","ROLE_USER"})
>   - ë¹„ì¸ê°€ì ì ‘ê·¼ ì‹œ AccessDeniedException ë˜ì§
> - @PreAuthorize : ìœ„ì™€ ë¹„ìŠ·í•˜ì§€ë§Œ spEL ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. @EnableGlobalMethodSecurity(prePostEnabled=true)ë¥¼ ì„¤ì •í•œë‹¤.
>   - @PreAuthorize("hasRole('ADMIN')")
> - @PostAuthorize : ìœ„ì™€ ë™ì¼
> - @AuthenticationPrincipal : ì»¨íŠ¸ë¡¤ëŸ¬ë‹¨ì—ì„œ ì„¸ì…˜ì˜ ì •ë³´ë“¤ì— ì ‘ê·¼í•˜ê³  ì‹¶ì„ ë•Œ íŒŒë¼ë¯¸í„°ì— ì„ ì–¸í•´ì¤€ë‹¤.
>   - \- public ModelAndView userInfo(@AuthenticationPrincipal User user)
>   - \- ì´ê±° ì•ˆì“°ê³  í™•ì¸í•˜ë ¤ë©´ (User) SecurityContextHolder.getContext().getAuthentication().getPrincipal(); ì´ëŸ°ì‹ìœ¼ë¡œ ì¨ì•¼í•œë‹¤.
>   - \- 4.x ë¶€í„°ëŠ” org.springframework.security.core.annotation.AuthenticationPrincipal ì„ import í•´ì•¼í•œë‹¤.
>   - \- mvc:annotation-driven.mvc:argument-resolvers ì— bean ìœ¼ë¡œ org.springframework.security.web.method.annotation.AuthenticationPrincipalArgumentResolver ë¥¼ ë“±ë¡í•œë‹¤.

<hr>

[ì°¸ê³  URL]

- https://coding-start.tistory.com/153 [ì½”ë”©ìŠ¤íƒ€íŠ¸]

- [http://springmvc.egloos.com/category/Spring%20Security](http://springmvc.egloos.com/category/Spring Security)
- https://www.holaxprogramming.com/2017/10/09/java-jvm-performance/